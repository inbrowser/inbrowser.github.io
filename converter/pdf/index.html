---
title: Image to PDF - Converter
layout: default
---

<!-- AUTHORS: QuentinRa (https://github.com/QuentinRa)
              DataSaiyentist (https://github.com/DataSaiyentist) -->

<h1 class="text-center text-color">{{ page.title }}</h1>
<p class="text-center text-color">
    We are using DropZone v5 (file upload), and PDF-LIB 1.17 (create PDF).
</p>

{% include dropzone.html message="Click or drop images (JPG or PNG) here" %}

<div>
    <div class="dropzone mt-5" id="dropzone"></div>

    <div class="mt-3">
        <table>
            <tr>
                <td><label for="show-preview"><b>Output</b></label></td>
                <td class="ps-3">
                    <select id="show-preview" type="checkbox" disabled>
                        <option>Show file in browser</option>
                        <option>Download</option>
                    </select>
                </td>
            </tr>
        </table>

        <button class="mt-3 float-end" onclick="onSubmit()">Process</button>
    </div>
</div>

<script src="https://unpkg.com/pdf-lib"></script>

<iframe id="pdf" style="min-height: 600px; width: 100%;" hidden></iframe>

<!-- create the PDF with the given image -->
<script>
    const displayDiv = document.getElementById('pdf');

    async function onSubmit() {
        const UploadedFiles = files;
        console.log(files)

        // Create a new PDF file
        const pdfDoc = await PDFLib.PDFDocument.create();

        const n = UploadedFiles.length;
        for (let i = 0; i < n; i++) {

            const file = UploadedFiles[i];
            const ImageBytes = await file.arrayBuffer();

            let fileImage;
            if (file.type === "image/jpg") {
                fileImage = await pdfDoc.embedJpg(ImageBytes);
            } else if (file.type === "image/png") {
                fileImage = await pdfDoc.embedPng(ImageBytes);
            } else {
                console.error(`Not supported file type: "${file.type}"`)
                continue;
            }

            // Get the width/height of the image
            const fileDims = fileImage.scale(1);

            // Create a blank page
            const page = pdfDoc.addPage();

            let height;
            let width;

            // PDF page dimensions
            const MAX_HEIGHT = page.getHeight();
            const MAX_WIDTH = page.getWidth();

            // We take into account difficult cases (both height and width are very high)
            let verification = 0;
            if (fileDims.width > MAX_WIDTH && fileDims.height > MAX_HEIGHT) {
                if (fileDims.height > fileDims.width) {
                    verification = 1;
                } else {
                    verification = 2
                }
            }
            if (fileDims.height > MAX_HEIGHT || verification === 1) {
                height = MAX_HEIGHT;
                width = Math.ceil(fileDims.width / fileDims.height * height);
            }
            if (fileDims.width > MAX_WIDTH || verification === 2) {
                width = MAX_WIDTH;
                height = Math.ceil(fileDims.height / fileDims.width * width);
            }
            // patch
            if (width == null || height == null) {
                width = fileDims.width;
                height = fileDims.height;
            }

            const options = {
                x: page.getWidth() / 2 - width / 2,
                y: page.getHeight() / 2 - height / 2,
                width: width,
                height: height
            };
            console.log(options)
            page.drawImage(fileImage, options);
        }

        displayDiv.src = await pdfDoc.saveAsBase64( {dataUri: true} );
        displayDiv.hidden = false;

    }
</script>

