{% if include.generate == "true" %}
<script>
    function generateMatrix(table, newHeight, newWidth, value=undefined) {
        const iterateHeight = Math.max(newHeight, table.rows.length);
        const iterateWidth = table.colsLength === undefined ? newWidth : Math.max(table.colsLength, newWidth);
        for (let i = 0; i < iterateHeight; i++) {
            // create or return row
            let tr = table.rows[i] === undefined ?  table.insertRow() : table.rows[i];
            for(let j = 0; j < iterateWidth; j++){
                // create or return column
                const td = tr.cells[j] === undefined ? tr.insertCell() : tr.cells[j];
                if (j >= newWidth) {
                    // hide
                    td.hidden = true;
                } else if (td.set === undefined) { // already created?
                    td.innerHTML = `<input type=\"text\" style="width: 50px;" value="">`;
                    td.set = true;
                } else if (td.hidden) {
                    td.hidden = false;
                }
                // set value
                if (value !== undefined) td.children[0].value = value;
            }
            // hide row if needed
            if (i >= newHeight) {
                // hide line
                tr.hidden = true;
            }  else if (tr.hidden) {
                tr.hidden = false;
            }
        }
        table.rowsLength = newHeight;
        table.colsLength = newWidth;
    }
    function regenerateMatrix(modifier="", value=undefined) {
        const table = document.getElementById("matrix-"+modifier)
        const inputRows = document.getElementById("input-rows-"+modifier)
        const inputCols = document.getElementById("input-columns-"+modifier)
        generateMatrix(table, inputRows.value, inputCols.value, value)
    }
    function regenerateSquareMatrix(modifier="", value=undefined) {
        const table = document.getElementById("matrix-"+modifier)
        const size = document.getElementById("size-"+modifier)
        generateMatrix(table, size.value, size.value, value)
    }
    function tableToArray(table) {
        let array = [];
        for (const row of table.rows) {
            if (row.hidden) continue;

            let rowArray = [];
            for (const cell of row.cells) {
                let value = cell.children[0].value;
                // empty => '0'
                if (value === '') { value = 0 }
				else value = mathjs.parse(value).evaluate();
                rowArray.push(value);
            }
            array.push(rowArray);
        }
        return array;
    }
</script>
{% endif %}