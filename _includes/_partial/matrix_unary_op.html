<h1 class="text-center text-color">{{ page.title }}</h1>
{% include _credits/maths_ocr.html %}

<!--
SUBMIT DATA
- A
- option: as fractions
-->
<div class="p-3 border-color container fs-5 mt-5">
	{% include _math/input_matrix.html modifier="A" generate="true" square_matrix="true" %}

	<details class="mt-3 border-color p-3">
		<summary>Options</summary>

		<table class="table border-color table-bordered table-striped mt-3">
			<tr>
				<td><label for="evaluate_fractions">Results as fractions.</label></td>
				<td><input id="evaluate_fractions" type="checkbox" {{ include.checked }}></td>
			</tr>
		</table>
	</details>

	<div class="mt-3 text-end">
		<button onclick="process()">Submit</button>
	</div>
</div>

<!--
SUBMIT DATA
-->
{% include _lib/matrix.html %}

<script>
	const matrix_A = document.querySelector('#matrix-A');
	const alt_matrix_option = document.querySelector('#evaluate_fractions');

	function process() {
		let A_array = tableToArray(matrix_A);
		let A = inbrowser_matrix.createMatrix(A_array.flat(), A_array.length, A_array.length)
		let json = inbrowser_matrix["{{ include.operation }}"](A)

		// show result
		results.hidden = false;

		if (json.result != null) {
			let matrix = json.result.toArray();
			if (!alt_matrix_option.checked) {
				// if alternate matrix enabled, show both 0.33 and 1/3
				results_div.innerHTML = `<p>@A^{-1} = ${matrixToLatex(matrix)}@</p>`
			} else {
				// show as fractions
				results_div.innerHTML = `<p>@A^{-1} = ${matrixToLatex(to_fractions(matrix))}@</p>`
			}
			MathJax.typesetPromise();
		} else {
			results_div.innerHTML = json.error;
		}
	}

	function to_fractions(matrix) {
		for (const i in matrix) {
			for (const j in matrix[i]) {
				let v = matrix[i][j];
				if (v !== 0 && (v = mathjs.fraction(v)).d !== 1) {
					matrix[i][j] = mathjs.format(v, { fraction: 'ratio' })
				}
			}
		}
		return matrix;
	}
</script>

{% include _partial/results_div.html mathjax="true" %}